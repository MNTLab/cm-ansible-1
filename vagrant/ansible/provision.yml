- name: Provision with Ansible
  hosts: all
  become: yes

  vars:
    services_info: |
      Jenkins URL - http://localhost:8080/jenkins/
      Jenkins Delivery - http://localhost:8080/jenkins/view/Pet%20CD/
      Application URL - http://localhost:8080/mnt-lab/
########################################################################################
  tasks:
  - name: Instaling Java
    yum: "name=java-1.7.0-openjdk-devel state=present"

  - name: Installing NGINX repo rpm
    yum: "name=http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm"

  - name: Installing NGINX
    yum: name=nginx state=latest

  - name: Changing nginx config
    copy: src=default.conf dest=/etc/nginx/conf.d/default.conf    

  - name: NGINX | Starting NGINX
    service: name=nginx state=started enabled=yes

  - name: Installing Tomcat
    yum: name=tomcat state=latest

  - name: Copyed Tomcat config
    copy: src=server.xml dest=/usr/share/tomcat/conf/server.xml
    #copy: src=sample.war dest=/usr/share/tomcat/webapps/sample.war

  - name: Starting Tomcat
    service: name=tomcat state=started enabled=yes

  - name: Downloading Jenkins from repo
    command: wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo

  - name: Jenkins repo key
    command: rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key

  - name: Jenkins install
    yum: name=jenkins state=latest

  - name: Jenkins starting
    service: name=jenkins state=started enabled=yes
######################################################################################################
  post_tasks:
  - debug: var=services_info.split('\n')
